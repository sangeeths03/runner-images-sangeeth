name: Reproduce create-dmg AppleEvent timeout

on:
  workflow_dispatch:

jobs:
  build-dmg:
    runs-on: macos-14
    steps:
      - uses: actions/checkout@v3

      - name: Install create-dmg
        run: npm install -g create-dmg

      - name: Create dummy app directory
        run: |
          mkdir -p release/darwin/MyApp.app/Contents/MacOS
          echo '#!/bin/bash' > release/darwin/MyApp.app/Contents/MacOS/MyApp
          chmod +x release/darwin/MyApp.app/Contents/MacOS/MyApp
          mkdir -p resources/mac-icons
          touch resources/mac-icons/icon.icns

      - name: Run create-dmg (may timeout)
        run: |
          create-dmg --volname="App" \
                     --volicon=resources/mac-icons/icon.icns \
                     --window-pos=200,120 \
                     --window-size=800,400 \
                     --icon-size=100 \
                     --icon=release/darwin/MyApp.app,200,190 \
                     --app-drop-link=600,185 \
                     ./release/darwin/output.dmg \
                     ./release/darwin/MyApp.app

